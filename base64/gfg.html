<!DOCTYPE html>
<html>

<head>
    <title>Base64 Encode/Decode Image</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }

        #base64Container {
            display: none;
            margin-top: 20px;
        }

        #base64String {
            width: 100%;
            height: 200px;
            resize: vertical;
            font-family: monospace;
        }

        #copyBtn {
            margin-top: 10px;
            padding: 6px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #copyBtn:hover {
            background-color: #0056b3;
        }

        #preview {
            max-width: 300px;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <input type="file" id="fileId" onchange="imageUploaded()">
    <br><br>

    <button onclick="displayString()">Mostrar Base64</button>
    <br><br>

    <img id="preview" />
    <br><br>

    <button id="download">Descargar Imagen</button>

    <div id="base64Container">
        <h3>Base64 String:</h3>
        <textarea id="base64String" readonly></textarea><br>
        <button id="copyBtn" onclick="copyBase64()">Copiar al portapapeles</button>
        <span id="copyStatus" style="margin-left:10px;"></span>
    </div>

    <script>
        let base64String = "";
        let originalFile = null;

        function imageUploaded() {
            originalFile = document.getElementById('fileId').files[0];
            if (!originalFile) return;

            const reader = new FileReader();

            reader.onload = function (e) {
                base64String = e.target.result;
                console.log("Base64 cargado:", base64String.substring(0, 80) + "...");

                const img = document.getElementById("preview");
                img.src = base64String;
                img.style.display = "block";
            };

            reader.readAsDataURL(originalFile);
        }

        function displayString() {
            if (!base64String) {
                alert("Primero selecciona una imagen");
                return;
            }

            document.getElementById("base64String").value = base64String;
            document.getElementById("base64Container").style.display = "block";
        }

        function copyBase64() {
            if (!base64String) return;

            navigator.clipboard.writeText(base64String)
                .then(() => {
                    const status = document.getElementById("copyStatus");
                    status.textContent = "✅ Copiado";
                    status.style.color = "green";
                    setTimeout(() => status.textContent = "", 2000);
                })
                .catch(err => {
                    console.error("Error al copiar:", err);
                    const status = document.getElementById("copyStatus");
                    status.textContent = "❌ Error al copiar";
                    status.style.color = "red";
                    setTimeout(() => status.textContent = "", 2000);
                });
        }

        document.getElementById('download').addEventListener('click', () => {
            if (!originalFile) {
                alert("Primero selecciona una imagen");
                return;
            }

            const url = URL.createObjectURL(originalFile);
            const link = document.createElement('a');
            link.href = url;
            link.download = originalFile.name || "imagen_descargada.png";
            link.click();
            URL.revokeObjectURL(url);
        });
    </script>
</body>

</html>
